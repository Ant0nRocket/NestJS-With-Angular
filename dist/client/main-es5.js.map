{"version":3,"sources":["webpack:///$_lazy_route_resource lazy namespace object","webpack:///src/client/app/app.component.ts","webpack:///src/client/app/app.component.html","webpack:///src/client/app/app.module.ts","webpack:///src/client/app/app.routes.ts","webpack:///src/client/app/components/components.module.ts","webpack:///src/client/app/components/footer/footer.component.ts","webpack:///src/client/app/components/footer/footer.component.html","webpack:///src/client/app/components/header/header.component.ts","webpack:///src/client/app/components/header/header.component.html","webpack:///src/client/app/components/main/auth/auth.component.ts","webpack:///src/client/app/components/main/auth/auth.component.html","webpack:///src/client/app/components/main/main.component.ts","webpack:///src/client/app/components/main/main.component.html","webpack:///src/client/app/components/main/welcome/welcome.component.ts","webpack:///src/client/app/components/main/welcome/welcome.component.html","webpack:///src/client/app/services/auth/auth.service.ts","webpack:///src/client/app/services/auth/signup-login-credentials.ts","webpack:///src/client/app/services/components/sidebar-toggle.service.ts","webpack:///src/client/app/services/services.module.ts","webpack:///src/client/app/services/websockets/websocket.options.ts","webpack:///src/client/app/services/websockets/websockets.service.ts","webpack:///src/client/environments/environment.ts","webpack:///src/client/main.ts","webpack:///src/shared/api.config.ts","webpack:///src/shared/auth/auth-credentials.dto.ts","webpack:///src/shared/websockets/websockets-theme.enum.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id","AppComponent","showSidebar","Component","selector","templateUrl","styleUrls","AppModule","BrowserModule","RouterModule","forRoot","ROUTES","HttpClientModule","BrowserAnimationsModule","FlexLayoutModule","ComponentsModule","ServicesModule","NgModule","declarations","imports","bootstrap","path","component","WelcomeComponent","AuthComponent","CommonModule","FormsModule","MatDividerModule","MatToolbarModule","MatSidenavModule","MatMenuModule","MatIconModule","MatButtonModule","MatInputModule","MatExpansionModule","HeaderComponent","FooterComponent","MainComponent","authService","sidebarService","router","mode","isLoginMode","isSignupMode","toggleMode","authErrors","credentials","SignupLoginCredentials","isAuthErrors","length","authStateChanged$","onAuthStateChanged$","subscribe","state","navigate","authErrors$","onAuthError$","err","push","unsubscribe","event","login","isPasswordsEqual","preventDefault","signUp","submit","toggleSidebar","sidebar","toggle","ViewChild","webSockets","webSocketConnectInProgress","onMessage","EventEmitter","hasMessages","receivedMessages","componentId","shortid","generate","message$","onMessageReceived$","dto","cid","content","emit","authToken","connect","setTimeout","theme","WebSocketsTheme","SendBackData","send","AuthService","http","Subject","user","undefined","_authToken","localStorage","getItem","userFromToken","JwtHelperService","decodeToken","_id","email","phone","username","authCredentials","post","apiConfig","urlSignup","token","error","statusCode","next","statucCode","urlLogin","authTokenDto","urlTokenCheck","writeUserFromToken","setItem","removeItem","Injectable","providedIn","password2","password","trim","AuthCredentialsDto","SidebarService","WebSocketOptions","_url","IntervalOfPingPongMs","intervalOfRoconnectionOnErrorMs","reconnectionAttemptsLimit","wsProtocolPrefix","location","protocol","startsWith","host","environment","production","replace","url","WebSocketsService","options","reconnectionAttemptsPassed","onConnectionOpen$","onConnectionClose$","onConnectionError$","authorized","close","ready","ws","WebSocket","onopen","idOfPingPongInterval","window","setInterval","onmessage","ev","data","JSON","parse","ClientConnected","sendAuthToken","Unauthorized","BadDto","onerror","reconnectionAttemptsLimitReached","onclose","clearInterval","AuthenticateWithToken","m","message2send","stringify","readyState","OPEN","enableProdMode","platformBrowser","bootstrapModule","console","urlApiBase","urlWebSocket","minUsernameLen","maxUsernameLen","minPasswordLen","maxPasswordLen","usernameRegex","passwordRegex","socketAuthDelay","isEmail","isMobilePhone","IsOptional","Matches","message","IsEmail","IsMobilePhone","IsNumber"],"mappings":"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","file":"main-es5.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"./$$_lazy_route_resource lazy recursive\";","import { Component } from '@angular/core';\n\n@Component({\n\tselector: 'app-root',\n\ttemplateUrl: './app.component.html',\n\tstyleUrls: [ './app.component.scss' ]\n})\nexport class AppComponent {\n\tpublic showSidebar = false;\n}\n","<app-header></app-header>\n<app-main></app-main>\n<app-footer></app-footer>\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { FlexLayoutModule } from '@angular/flex-layout';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { RouterModule } from '@angular/router';\n\nimport { ComponentsModule } from './components/components.module';\nimport { ServicesModule } from './services/services.module';\nimport { ROUTES } from './app.routes';\n\nimport { AppComponent } from './app.component';\n\n@NgModule({\n\tdeclarations: [ AppComponent ],\n\timports: [\n\t\t// Angular modules\n\t\tBrowserModule,\n\t\tRouterModule.forRoot(ROUTES),\n\t\tHttpClientModule,\n\t\tBrowserAnimationsModule,\n\n\t\tFlexLayoutModule,\n\n\t\t// User modules\n\t\tComponentsModule,\n\t\tServicesModule\n\t],\n\tbootstrap: [ AppComponent ]\n})\nexport class AppModule {}\n","import { Routes } from '@angular/router';\nimport { AuthGuard } from './guards/auth.guard';\nimport { AuthComponent } from './components/main/auth/auth.component';\nimport { WelcomeComponent } from './components/main/welcome/welcome.component';\n\nexport const ROUTES: Routes = [\n\t// default page - welcome\n\t{ path: '', component: WelcomeComponent },\n\n\t// sign-up and login\n\t{ path: 'auth', component: AuthComponent }\n];\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\n\nimport { FlexLayoutModule } from '@angular/flex-layout';\n\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatExpansionModule } from '@angular/material/expansion';\n\nimport { HeaderComponent } from './header/header.component';\nimport { MainComponent } from './main/main.component';\nimport { FooterComponent } from './footer/footer.component';\nimport { WelcomeComponent } from './main/welcome/welcome.component';\nimport { AuthComponent } from './main/auth/auth.component';\n\n@NgModule({\n\tdeclarations: [\n\t\t// Shared\n\t\tHeaderComponent,\n\t\tFooterComponent,\n\t\tMainComponent,\n\n\t\t// Specific components\n\t\tAuthComponent,\n\t\tWelcomeComponent\n\t],\n\texports: [ HeaderComponent, FooterComponent, MainComponent ],\n\timports: [\n\t\tCommonModule,\n\t\tFormsModule,\n\t\tRouterModule,\n\n\t\tFlexLayoutModule,\n\n\t\t// Material\n\t\tMatDividerModule,\n\t\tMatToolbarModule,\n\t\tMatSidenavModule,\n\t\tMatMenuModule,\n\t\tMatIconModule,\n\t\tMatButtonModule,\n\t\tMatInputModule,\n\t\tMatExpansionModule\n\t]\n})\nexport class ComponentsModule {}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n\tselector: 'app-footer',\n\ttemplateUrl: './footer.component.html',\n\tstyleUrls: [ './footer.component.scss' ]\n})\nexport class FooterComponent implements OnInit {\n\tconstructor() {}\n\n\tngOnInit(): void {}\n}\n","<footer>\n    Copyright 2020 &copy; <a href=\"mailto:anton.stephanyak@gmail.com\">Anton Stephanyak</a> (Ant0nRocket)\n</footer>","import { Component, OnInit, Output, EventEmitter } from '@angular/core';\nimport { AuthService } from '../../services/auth/auth.service';\nimport { SidebarService } from '../../services/components/sidebar-toggle.service';\n\n@Component({\n\tselector: 'app-header',\n\ttemplateUrl: './header.component.html',\n\tstyleUrls: [ './header.component.scss' ]\n})\nexport class HeaderComponent implements OnInit {\n\tconstructor(public authService: AuthService, public sidebarService: SidebarService) {}\n\n\tngOnInit(): void {}\n}\n","<mat-toolbar color=\"primary\">\n    <mat-toolbar-row>\n        <button mat-icon-button (click)=\"sidebarService.toggleSidebar.emit()\">\n            <mat-icon>menu</mat-icon>\n        </button>\n\n        <h1>\n            <a routerLink=\"/\" class=\"app-name\">Lists</a>\n        </h1>\n        \n        <span fxFlex></span>\n\n        <button mat-raised-button color=\"warn\" [routerLink]=\"['/auth']\" routerLinkActive=\"invisible\" *ngIf=\"!authService.authToken\">\n            <mat-icon>person</mat-icon> LOG IN\n        </button>\n\n        <div *ngIf=\"authService.authToken\">\n            <mat-menu #appMenu=\"matMenu\">\n                <button mat-menu-item (click)=\"authService.logout()\">\n                    <mat-icon>exit_to_app</mat-icon>\n                    Exit\n                </button>\n            </mat-menu>\n            \n            <button mat-raised-button [matMenuTriggerFor]=\"appMenu\">\n                <mat-icon>person</mat-icon>\n                {{ authService.user.username || authService.user.email || authService.user.phone }}\n            </button>\n        </div>\n    </mat-toolbar-row>\n</mat-toolbar>\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { AuthService } from '../../../services/auth/auth.service';\nimport { SignupLoginCredentials } from '../../../services/auth/signup-login-credentials';\nimport { Subscription } from 'rxjs';\nimport { Router } from '@angular/router';\n\n@Component({\n\tselector: 'app-auth',\n\ttemplateUrl: './auth.component.html',\n\tstyleUrls: [ './auth.component.css' ]\n})\nexport class AuthComponent implements OnInit, OnDestroy {\n\t// Work mode (log-in or sign-up)\n\tpublic mode = 'log-in';\n\tpublic isLoginMode = () => this.mode === 'log-in';\n\tpublic isSignupMode = () => !this.isLoginMode();\n\tpublic toggleMode = () => {\n\t\tthis.mode = this.isLoginMode() ? 'sign-up' : 'log-in';\n\t\tthis.authErrors = [];\n\t};\n\n\t// Model\n\tpublic credentials: SignupLoginCredentials = new SignupLoginCredentials();\n\n\t// Auth subscribtions\n\tprivate authStateChanged$: Subscription;\n\tprivate authErrors$: Subscription;\n\n\t// Auth errors\n\tpublic authErrors: string[] = [];\n\tpublic isAuthErrors = () => this.authErrors.length > 0;\n\n\tconstructor(private authService: AuthService, private router: Router) {}\n\n\tngOnInit(): void {\n\t\tthis.authStateChanged$ = this.authService.onAuthStateChanged$.subscribe((state) => {\n\t\t\tif (state) this.router.navigate([ '' ]);\n\t\t});\n\t\tthis.authErrors$ = this.authService.onAuthError$.subscribe((err) => {\n\t\t\tthis.authErrors.push(err);\n\t\t});\n\t}\n\n\tngOnDestroy(): void {\n\t\tthis.authErrors$.unsubscribe();\n\t\tthis.authStateChanged$.unsubscribe();\n\t}\n\n\tpublic submit(event: Event) {\n\t\t// we could be here only if SUBMIT which is enabled only\n\t\t// if form is valid. But we should manually check pass1 and pass2.\n\t\tthis.authErrors = [];\n\n\t\tif (this.isLoginMode()) {\n\t\t\t// nothing to check here, go ahead!\n\t\t\tthis.authService.login(this.credentials);\n\t\t} else {\n\t\t\tif (!this.credentials.isPasswordsEqual()) {\n\t\t\t\tevent.preventDefault(); // stop submitting\n\t\t\t\tthis.authErrors.push('Passwords must be equal.');\n\t\t\t} else {\n\t\t\t\tthis.authService.signUp(this.credentials);\n\t\t\t}\n\t\t}\n\t}\n}\n","<form #form=\"ngForm\" (ngSubmit)=\"submit($event)\">\n\n    <div class=\"auth-errors\" *ngIf=\"isAuthErrors()\">\n        <p *ngFor=\"let error of authErrors\">{{ error }}</p>\n        <!-- <button mat-raised-button (click)=\"authErrors = []\" color=\"warn\">OK</button> -->\n    </div>\n\n    <div *ngIf=\"isLoginMode()\">\n        Don't have an account? <span class=\"like-link\" (click)=\"toggleMode()\">Register</span> now!\n    </div>\n\n    <div *ngIf=\"isSignupMode()\">\n        Already have an account? <span class=\"like-link\" (click)=\"toggleMode()\">Log-in</span> now!\n    </div>\n\n    <mat-divider></mat-divider>\n\n    <mat-form-field>\n        <mat-label>User ID</mat-label>\n        <input matInput placeholder=\"login, email or mobile\" name=\"username\" [(ngModel)]=\"credentials.id\" required>\n    </mat-form-field>\n\n    <mat-form-field>\n        <mat-label>Password</mat-label>\n        <input matInput type=\"password\" placeholder=\"Any non-empty string\" name=\"password\" [(ngModel)]=\"credentials.password\" required>\n    </mat-form-field>\n\n    <mat-form-field *ngIf=\"isSignupMode()\">\n        <mat-label>Password confirmation</mat-label>\n        <input matInput type=\"password\" placeholder=\"Same password once again\" name=\"password2\" [(ngModel)]=\"credentials.password2\" required>\n    </mat-form-field>\n\n    <button type=\"submit\" mat-raised-button color=\"warn\" [disabled]=\"form.invalid\">{{ mode | uppercase }}</button>\n</form>","import { Component, OnInit, Input, ViewChild, EventEmitter } from '@angular/core';\nimport { MatSidenav } from '@angular/material/sidenav';\nimport { SidebarService } from '../../services/components/sidebar-toggle.service';\n\n@Component({\n\tselector: 'app-main',\n\ttemplateUrl: './main.component.html',\n\tstyleUrls: [ './main.component.scss' ]\n})\nexport class MainComponent implements OnInit {\n\t@ViewChild('sidebar') sidebar: MatSidenav;\n\n\tconstructor(private sidebarService: SidebarService) {}\n\n\tngOnInit(): void {\n\t\tthis.sidebarService.toggleSidebar.subscribe(() => this.sidebar.toggle());\n\t}\n}\n","<mat-sidenav-container>\n    <mat-sidenav #sidebar>\n        Lorem ipsum dolor sit amet consectetur adipisicing elit. Eveniet, temporibus?\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n        <router-outlet></router-outlet>\n    </mat-sidenav-content>\n</mat-sidenav-container>","import { Component, OnInit, EventEmitter } from '@angular/core';\nimport { AuthService } from '../../../services/auth/auth.service';\nimport * as shortid from 'shortid';\nimport { WebSocketsService } from '../../../services/websockets/websockets.service';\nimport { WebSocketsDto } from '../../../../../shared/websockets/websockets.dto';\nimport { Subscription } from 'rxjs';\nimport { WebSocketsTheme } from '../../../../../shared/websockets/websockets-theme.enum';\n\n@Component({\n\tselector: 'app-welcome',\n\ttemplateUrl: './welcome.component.html',\n\tstyleUrls: [ './welcome.component.css' ]\n})\nexport class WelcomeComponent implements OnInit {\n\tpublic webSocketConnectInProgress = true;\n\n\tpublic onMessage: EventEmitter<Array<string>> = new EventEmitter();\n\n\tpublic hasMessages = () => this.receivedMessages.length > 0;\n\n\tprivate componentId = shortid.generate();\n\tprivate message$: Subscription;\n\tprivate receivedMessages: string[] = [];\n\n\tconstructor(public authService: AuthService, public webSockets: WebSocketsService) {\n\t\tthis.message$ = webSockets.onMessageReceived$.subscribe((dto: WebSocketsDto) => {\n\t\t\tif (dto.cid !== this.componentId) return; // filter messages not from this component\n\t\t\tif (this.receivedMessages.length > 4) this.receivedMessages = [];\n\t\t\tthis.receivedMessages.push(dto.content);\n\t\t\tthis.onMessage.emit(this.receivedMessages);\n\t\t});\n\t}\n\n\tngOnInit(): void {\n\t\tif (this.authService.authToken) {\n\t\t\tthis.webSockets.connect();\n\t\t\tsetTimeout(() => (this.webSocketConnectInProgress = false), 3000);\n\t\t}\n\t}\n\n\ttestWebSockets() {\n\t\tconst dto: WebSocketsDto = {\n\t\t\tcid: this.componentId,\n\t\t\tcontent: shortid.generate(),\n\t\t\ttheme: WebSocketsTheme.SendBackData\n\t\t};\n\t\tthis.webSockets.send(dto); // if sockets not ready - send to nowhere :)\n\t}\n}\n","<div *ngIf=\"!authService.authToken\">\n    <p>\n        Hello and welcome to <b>NestJS with Angular</b> website. <br>\n        My name is <a href=\"mailto:anton.stephanyak@gmail.com\">Anton Stephanyak</a>\n        (aka Ant0nRocket <sup><a href=\"https://github.com/Ant0nRocket\" target=\"_blank\">GIT</a></sup>) and I'm glad to see you!\n    </p>\n    <p>\n        Main purpose of this resource is to demonstrate my ability of creating\n        websites such as this one. \n    </p>\n    <p>\n        In the top-right corner there is a LOG IN button. Please, click it and perform quick\n        registration (provide fake ID, no confirmation required, you will immediately loged-in).<br>\n        There are two reasons why you should do that:\n    </p>\n    <ol>\n        <li>\n            I'll proove my ability of creating auth stuff.\n        </li>\n        <li>\n            WebSockets features available only for signed-in users.\n        </li>\n    </ol>\n</div>\n\n<div *ngIf=\"authService.authToken\">\n    <p *ngIf=\"!hasMessages()\">\n        Outstanding, <b>{{ authService.user.username || authService.user.email || authService.user.phone }}</b>!\n    </p>\n    <p *ngIf=\"!hasMessages()\">\n        Now you can perform WebSockets test.\n    </p>\n    <p *ngIf=\"webSocketConnectInProgress\">Let's wait few seconds for connection to be established...</p>\n\n    <div *ngIf=\"!webSocketConnectInProgress && !webSockets.ready\">\n        <p>Ooops! I'm very sorry, but something goes wrong with back-end. Please, try later :(</p>\n    </div>\n\n    <div *ngIf=\"!webSocketConnectInProgress && webSockets.ready\">\n        <p *ngIf=\"!hasMessages()\">\n            Ok! Everything is ready! Our back-end had just accepted our connection. Let's play a ping-pong game with him!\n        </p>\n        <p *ngIf=\"!hasMessages()\">\n            See that button with \"TEST\" label? When you will click it, a random string will be generated\n            and sent to the server via WebSocket. Then the server will return us this string and you will see its \n            content in the list below. Go ahead! Click!\n        </p>\n        <p>\n            <button mat-stroked-button color=\"link\" (click)=\"testWebSockets()\">TEST</button>            \n        </p>\n        <ol>\n            <li *ngFor=\"let message of (onMessage | async)\">{{ message }}</li>\n        </ol>\n\n        <div *ngIf=\"hasMessages()\">\n            <mat-divider></mat-divider>\n    \n            <p>And all that messages are not just client generated and added in list. They truly were sent to server and get back. You can easily check this in Network tab of the development tools of your browser. Just select \"/\" websocket connection and look inside the tab \"Messages\".</p>\n        </div>\n    </div>\n</div>\n\n<mat-divider></mat-divider>\n\n<mat-expansion-panel>\n    <mat-expansion-panel-header>\n        List of technologies used here\n    </mat-expansion-panel-header>\n    <ul>\n        <li>Angular (for front-end)</li>\n        <ul>\n            <li>Angular Material components were used for styling</li>\n        </ul>\n        <li>NestJS (for back-end)</li>\n        <li>TypeScript (both for front and back)</li>\n        <li>WebSockets API</li>\n        <li>MongoDB</li>\n        <li>Git</li>\n        <li>Heroku (deploying using one of project's git branches)</li>\n        <ul>\n            <li>mLab addon for production MongoDB base</li>\n        </ul>\n    </ul>\n</mat-expansion-panel>\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport { Subject } from 'rxjs';\n\nimport { ServicesModule } from '../services.module';\n\nimport { AuthCredentialsDto } from '../../../../shared/auth/auth-credentials.dto';\nimport { apiConfig } from '../../../../shared/api.config';\nimport { AuthTokenDto } from '../../../../shared/auth/auth-token.dto';\nimport { IUserBase } from '../../../../shared/interfaces/user-base.interface';\nimport { Router } from '@angular/router';\nimport { SignupLoginCredentials } from './signup-login-credentials';\n\n@Injectable({\n\tprovidedIn: ServicesModule\n})\nexport class AuthService {\n\tpublic onAuthStateChanged$: Subject<boolean> = new Subject();\n\tpublic onAuthError$: Subject<string> = new Subject();\n\n\tpublic user: IUserBase = undefined;\n\n\tprivate _authToken: string = null;\n\n\tget authToken(): string {\n\t\treturn this._authToken;\n\t}\n\n\tset authToken(authToken: string) {\n\t\tthis._authToken = authToken;\n\t\tif (this._authToken) {\n\t\t\t// success login\n\t\t\tthis.writeUserFromToken(authToken);\n\t\t\tlocalStorage.setItem('authToken', authToken);\n\t\t\tthis.onAuthStateChanged$.next(true);\n\t\t} else {\n\t\t\t// failed log-in\n\t\t\tlocalStorage.removeItem('authToken');\n\t\t\tthis.onAuthStateChanged$.next(false);\n\t\t}\n\t}\n\n\tconstructor(private http: HttpClient, private router: Router) {\n\t\tthis.authToken = localStorage.getItem('authToken');\n\t}\n\n\t//------------------------------------------------------------------------\n\t/** Decodes token (which is IUserBase from API) and writes in this.user */\n\tprivate writeUserFromToken(authToken: string) {\n\t\tconst userFromToken: IUserBase = new JwtHelperService().decodeToken(authToken);\n\t\tconst { _id, email, phone, username } = userFromToken;\n\t\tthis.user = { _id, email, phone, username };\n\t}\n\n\t//----------------------------------------------------------------\n\t/** Sends auth credentials to server and subscribes to response */\n\tpublic signUp(authCredentials: SignupLoginCredentials) {\n\t\tthis.http.post<AuthTokenDto>(apiConfig.urlSignup, authCredentials).subscribe(\n\t\t\t// remember that authToken setter will call appropriate subject\n\t\t\t(dto) => {\n\t\t\t\tthis.authToken = dto.token;\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tthis.authToken = null;\n\n\t\t\t\tif (\n\t\t\t\t\terr.error.statusCode === 409 // User exists\n\t\t\t\t)\n\t\t\t\t\tthis.onAuthError$.next('User already exists.');\n\t\t\t\tif (\n\t\t\t\t\terr.error.statucCode === 400 // Bad request\n\t\t\t\t)\n\t\t\t\t\tthis.onAuthError$.next('Some error occured. Check input.');\n\t\t\t\tif (\n\t\t\t\t\terr.error.statucCode === 500 // server error\n\t\t\t\t)\n\t\t\t\t\tthis.onAuthError$.next('Some server side error. Try later.');\n\t\t\t}\n\t\t);\n\t}\n\n\t//-----------------------------\n\t/** Same as signup, actually */\n\tpublic login(authCredentials: AuthCredentialsDto) {\n\t\tthis.http.post<AuthTokenDto>(apiConfig.urlLogin, authCredentials).subscribe(\n\t\t\t(dto) => {\n\t\t\t\tthis.authToken = dto.token;\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tif (err.error.statucCode !== 504) {\n\t\t\t\t\tthis.authToken = null;\n\t\t\t\t\tthis.onAuthError$.next('Invalid login or password.');\n\t\t\t\t} else {\n\t\t\t\t\tthis.onAuthError$.next(\"Server isn't responding. Try later.\");\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t//----------------------------\n\t/** Checks auth token valid */\n\tpublic checkToken(authTokenDto?: AuthTokenDto) {\n\t\tif (!authTokenDto) authTokenDto = { token: this.authToken };\n\n\t\tthis.http.post(apiConfig.urlTokenCheck, authTokenDto).subscribe(\n\t\t\t(dto: AuthTokenDto) => {\n\t\t\t\tthis.authToken = dto.token;\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tif (err.error.statucCode < 500) {\n\t\t\t\t\tthis.authToken = null;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t//----------------------------\n\t/** Sets auth token to null */\n\tpublic logout() {\n\t\tthis.authToken = null;\n\t\tthis.router.navigate([ '' ]);\n\t}\n}\n","import { AuthCredentialsDto } from '../../../../shared/auth/auth-credentials.dto';\n\nexport class SignupLoginCredentials extends AuthCredentialsDto {\n\tpassword2: string = '';\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.password = '';\n\t\tthis.password2 = '';\n\t}\n\n\tisPasswordsEqual(): boolean {\n\t\tif (!this.password || !this.password2) return false;\n\t\treturn this.password === this.password2;\n\t}\n\n\tisEmpty(): boolean {\n\t\tif (!this.id || !this.password) return true;\n\t\treturn this.id.trim().length === 0 || this.password.length === 0;\n\t}\n}\n","import { Injectable, EventEmitter } from '@angular/core';\nimport { ServicesModule } from '../services.module';\n\n@Injectable({\n\tprovidedIn: ServicesModule\n})\nexport class SidebarService {\n\tpublic toggleSidebar: EventEmitter<void> = new EventEmitter();\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n\r\n@NgModule({\r\n    imports: [\r\n        CommonModule,\r\n    ],\r\n})\r\nexport class ServicesModule { }\r\n","import { environment } from \"../../../environments/environment\";\r\n\r\nexport class WebSocketOptions {\r\n\r\n    /** Connection URL. */\r\n    private _url = '';\r\n\r\n    /** Connection URL. By default - host root. */\r\n    public get url(): string {\r\n        if (this._url === '') {\r\n            // if your you have HTTPS connection then (at least Firefox) will\r\n            // block attempts to connect to ws:// resources because they are\r\n            // \"insecure connection\"'s. In that case you should provide wss:// url\r\n            const wsProtocolPrefix =\r\n                location.protocol.startsWith('https') ? 'wss://' : 'ws://';\r\n\r\n            this._url = wsProtocolPrefix + location.host;\r\n\r\n            if (!environment.production) {\r\n                // in dev mode backend usualy on 3000 port, so let's change it\r\n                this._url = this._url.replace('4200', '3000');\r\n            }\r\n        }\r\n\r\n        return this._url;\r\n    }\r\n\r\n    public set url(url: string) {\r\n        this._url = url;\r\n    }\r\n\r\n    /**\r\n    * For exanple, Heroku closes any connection in 30 sec.\r\n    * if there were no packages transmited.\r\n    * Below there is Ping-Pong code which fire every 25000 ms.\r\n    */\r\n    public IntervalOfPingPongMs = 20000;\r\n\r\n    /** \r\n     * If WebSocket closed because of some error it will\r\n     * try to reconnect every 5 seconds\r\n     */\r\n    public intervalOfRoconnectionOnErrorMs = 5000;\r\n\r\n    /** Max amount of reconnection attempts */\r\n    public reconnectionAttemptsLimit = 10;\r\n}","import { Injectable, EventEmitter } from '@angular/core';\r\n\r\nimport { ServicesModule } from '../services.module';\r\nimport { WebSocketOptions } from './websocket.options';\r\nimport { AuthService } from '../auth/auth.service';\r\n\r\nimport { WebSocketsDto } from '../../../../shared/websockets/websockets.dto';\r\nimport { WebSocketsTheme } from '../../../../shared/websockets/websockets-theme.enum';\r\n\r\n@Injectable({\r\n  providedIn: ServicesModule\r\n})\r\nexport class WebSocketsService {\r\n\r\n  /** Instance of WebSocket */\r\n  private ws: WebSocket;\r\n\r\n  /** Connection options */\r\n  private options: WebSocketOptions = new WebSocketOptions();\r\n\r\n  /** ID of ping-pong interval */\r\n  private idOfPingPongInterval: number;\r\n\r\n  /** Currect reconnection attempts count */\r\n  private reconnectionAttemptsPassed = 0;\r\n\r\n  /** \r\n   * Reconnections limit reached. It's important to stop reconnection\r\n   * attempts after some amout fails 'cause of memory leaks\r\n   */\r\n  private get reconnectionAttemptsLimitReached(): boolean {\r\n    return this.reconnectionAttemptsPassed >= this.options.reconnectionAttemptsLimit;\r\n  }\r\n\r\n  /** Whether websocket open or not */\r\n  public get ready(): boolean {\r\n    return this.ws?.readyState === WebSocket.OPEN;\r\n  }\r\n\r\n  /** \r\n   * Occurred when WebSocket connection open. \r\n   * The fact that it's open doesn't mean that it's ready.\r\n   * Check [ready] getter for this. \r\n   */\r\n  public onConnectionOpen$: EventEmitter<void> = new EventEmitter();\r\n\r\n  /** Occurred when WebSocket closed for any reason */\r\n  public onConnectionClose$: EventEmitter<void> = new EventEmitter();\r\n\r\n  /** Emits when there is new message from server */\r\n  public onMessageReceived$: EventEmitter<WebSocketsDto> = new EventEmitter();\r\n\r\n  /** Occurred when some error in WebSocket connection */\r\n  public onConnectionError$: EventEmitter<string> = new EventEmitter();\r\n\r\n  constructor(private authService: AuthService) {\r\n    authService.onAuthStateChanged$.subscribe(\r\n      (authorized: boolean) => {\r\n        if (!authorized) this.close();\r\n      });\r\n  }\r\n\r\n  /** \r\n   * Connects to WebSocket server. \r\n   * If there is an open connection then nothing will happen.\r\n   */\r\n  public connect(options?: WebSocketOptions) {\r\n    if (this.ready) return; // already connected and authorized - return\r\n    if (options) this.options = options; // remember options\r\n    this.ws = new WebSocket(this.options.url); // initialize new websocket connection\r\n\r\n    this.ws.onopen = () => {\r\n      this.idOfPingPongInterval =\r\n        window.setInterval(() => { this.send() }, this.options.IntervalOfPingPongMs);\r\n    };\r\n\r\n    this.ws.onmessage = (ev) => { // received message\r\n      try {\r\n        const data: WebSocketsDto = JSON.parse(ev.data);\r\n        if (data.theme === WebSocketsTheme.ClientConnected) {\r\n          this.sendAuthToken();\r\n        } else if (data.theme === WebSocketsTheme.Unauthorized) {\r\n          this.close();\r\n        } else {\r\n          this.onMessageReceived$.emit(data);\r\n        }\r\n      } catch {\r\n        this.onMessageReceived$.emit({\r\n          cid: '',\r\n          theme: WebSocketsTheme.BadDto,\r\n          content: ev.data\r\n        });\r\n      }\r\n    };\r\n\r\n    this.ws.onerror = (ev: Event) => {\r\n      this.onConnectionError$.emit(`Error: ${ev}`);\r\n      setTimeout(() => {\r\n        if (!this.reconnectionAttemptsLimitReached && !this.ready) {\r\n          this.reconnectionAttemptsPassed++;\r\n          this.connect();\r\n        }\r\n      }, this.options.intervalOfRoconnectionOnErrorMs);\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      window.clearInterval(this.idOfPingPongInterval);\r\n    };\r\n  }\r\n\r\n  /** \r\n   * Sends existing authToken (whether it valid or not).\r\n    */\r\n  private sendAuthToken() {\r\n    const dto: WebSocketsDto = {\r\n      cid: '',\r\n      theme: WebSocketsTheme.AuthenticateWithToken,\r\n      content: this.authService.authToken\r\n    };\r\n    this.send(dto);\r\n  }\r\n\r\n  /** \r\n   * Closes connection to server (if it's in OPEN state).\r\n   */\r\n  public close() {\r\n    this.ws?.close();\r\n  }\r\n\r\n  /** \r\n   * Sends a WebSocketsDto to server.   \r\n   * If Connection is not OPEN then nothing will happen.   \r\n   * If no WebSocketsDto provided then empty string will be sent.   \r\n   * It can be useful in Ping-Pong algorythm.\r\n   */\r\n  public send(m?: WebSocketsDto | string) {\r\n    if (!this.ready) return;\r\n    if (!m) m = '';\r\n    const message2send = typeof m === 'string' ? m : JSON.stringify(m);\r\n    this.ws.send(message2send);\r\n  }\r\n}\r\n","// This file can be replaced during build by using the `fileReplacements` array.\r\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\r\n// The list of file replacements can be found in `angular.json`.\r\n\r\nexport const environment = {\r\n  production: false\r\n};\r\n\r\n/*\r\n * For easier debugging in development mode, you can import the following file\r\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\r\n *\r\n * This import should be commented out in production mode because it will have a negative impact\r\n * on performance if an error is thrown.\r\n */\r\n// import 'zone.js/dist/zone-error';  // Included with Angular CLI.\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule)\r\n  .catch(err => console.error(err));\r\n","const urlApiBase = '/api';\r\n\r\nexport const apiConfig = {\r\n    urlWebSocket: '/socket',\r\n    urlSignup: urlApiBase + '/signup',\r\n    urlLogin: urlApiBase + '/login',\r\n    urlTokenCheck: urlApiBase + '/check-token',\r\n    minUsernameLen: 1,\r\n    maxUsernameLen: 30,\r\n    minPasswordLen: 1,\r\n    maxPasswordLen: 30,\r\n    usernameRegex: /^[A-Za-z--0-9\\s.\\-_]+$/,\r\n    passwordRegex: /^[A-Za-z--0-9\\s.\\-`~!@#$%^&*()_=+|?]+$/,\r\n    socketAuthDelay: 5000, // 5 seconds\r\n}","import { IsEmail, Matches, IsMobilePhone, IsOptional, IsNumber } from 'class-validator';\nimport { isEmail, isMobilePhone } from 'class-validator';\nimport { apiConfig } from '../api.config';\nimport { IUserFull } from '../interfaces/user-full.interface';\n\n/** \n * Pass username, email or phone number as user ID.\n * Password is password. \n */\nexport class AuthCredentialsDto implements IUserFull {\n\t@IsOptional()\n\t@Matches(apiConfig.usernameRegex, {\n\t\tmessage: `Username doesn't match the rule: ${apiConfig.usernameRegex}`\n\t})\n\tusername?: string;\n\n\t@IsOptional()\n\t@IsEmail()\n\temail?: string;\n\n\t@IsOptional()\n\t@IsMobilePhone()\n\tphone?: string;\n\n\t@IsNumber({}, { message: 'no username, email or phone found' })\n\tget hasSomeId(): number | undefined {\n\t\tif (!this.username) if (!this.email) if (!this.phone) return undefined;\n\n\t\treturn 1;\n\t}\n\n\t@Matches(apiConfig.passwordRegex, {\n\t\tmessage: `Password doesn't match the rule: ${apiConfig.passwordRegex}`\n\t})\n\tpassword: string;\n\n\t//-----------------\n\t// Magic with ID :)\n\n\tpublic set id(id: string) {\n\t\tthis.username = null;\n\t\tthis.email = null;\n\t\tthis.phone = null;\n\n\t\tif (isEmail(id)) this.email = id;\n\t\telse if (isMobilePhone(id)) this.phone = id;\n\t\telse this.username = id;\n\t}\n\n\tpublic get id() {\n\t\tconst id = this.username || this.email || this.phone;\n\t\treturn id;\n\t}\n}\n","export enum WebSocketsTheme {\r\n    /** \r\n     * Server sends this when socket connection open. \r\n     * Client should respond with valid auth token or\r\n     * server will close client connection in apiConfig.socketAuthDelay\r\n     * seconds\r\n     */\r\n    ClientConnected,\r\n\r\n    /**\r\n     * Client sends this after receiving [ClientConnected] theme.\r\n     * In content there should be a valid auth token.\r\n     */\r\n    AuthenticateWithToken,\r\n\r\n    /**\r\n     * Use when client was disconnected by auth timeout or\r\n     * provided token is invalid.\r\n     */\r\n    Unauthorized,\r\n\r\n\r\n    /** Use it when server didn't understand command. */\r\n    BadDto,\r\n\r\n    /** For DTO filtering */\r\n    EndOfServiceCommands,\r\n\r\n    ///////////////////////////////////////////////////////////////////////////\r\n    ///////////////////////////////////////////////////////////////////////////\r\n    ///////////////////////////////////////////////////////////////////////////\r\n\r\n    /** Server should return DTO as it is */\r\n    SendBackData,\r\n}"]}